<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Resultados de Partidos</title>
</head>
<body>
  <h1>Registrar resultados</h1>

  <form id="formResultados">
    Partido:
    <select id="partidoSelect" required></select><br><br>

    Set 1: <input type="number" id="set1p1" min="0" max="7"> -
           <input type="number" id="set1p2" min="0" max="7"><br><br>
    Set 2: <input type="number" id="set2p1" min="0" max="7"> -
           <input type="number" id="set2p2" min="0" max="7"><br><br>
    Set 3: <input type="number" id="set3p1" min="0" max="7"> -
           <input type="number" id="set3p2" min="0" max="7"><br><br>

    <button type="submit">Guardar resultados</button>
  </form>

  <script>
    const api = 'http://localhost:3000';

    async function cargarPartidos() {
      const res = await fetch(`${api}/partidos`);
      const partidos = await res.json();
      const select = document.getElementById('partidoSelect');
      partidos.forEach(p => {
        const opt = document.createElement('option');
        opt.value = p.Id;
        opt.textContent = `${p.Zona ?? '-'}: ${p.Pareja1Jugador1} / ${p.Pareja1Jugador2} vs ${p.Pareja2Jugador1} / ${p.Pareja2Jugador2}`;
        select.appendChild(opt);
      });
    }

    document.getElementById('formResultados').addEventListener('submit', async e => {
      e.preventDefault();

      const partidoId = document.getElementById('partidoSelect').value;
      const datos = {
        set1p1: Number(document.getElementById('set1p1').value || 0),
        set1p2: Number(document.getElementById('set1p2').value || 0),
        set2p1: Number(document.getElementById('set2p1').value || 0),
        set2p2: Number(document.getElementById('set2p2').value || 0),
        set3p1: Number(document.getElementById('set3p1').value || 0),
        set3p2: Number(document.getElementById('set3p2').value || 0),
      };

      const res = await fetch(`${api}/partidos/${partidoId}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(datos)
      });

      if (res.ok) {
        alert('Resultados guardados');
        document.getElementById('formResultados').reset();
      } else {
        alert('Error al guardar resultados');
      }
    });

    window.onload = cargarPartidos;
  </script>
</body>
</html>
